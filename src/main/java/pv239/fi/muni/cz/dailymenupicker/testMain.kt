package pv239.fi.muni.cz.dailymenupicker

import org.jsoup.Jsoup
import org.xml.sax.InputSource
import pv239.fi.muni.cz.dailymenupicker.parser.config.Day
import pv239.fi.muni.cz.dailymenupicker.parser.config.Menu
import pv239.fi.muni.cz.dailymenupicker.parser.day.getDayParser
import pv239.fi.muni.cz.dailymenupicker.parser.entity.FoodEntity
import pv239.fi.muni.cz.dailymenupicker.parser.exception.UnknownDayParser
import pv239.fi.muni.cz.dailymenupicker.parser.exception.UnknownMenuParser
import pv239.fi.muni.cz.dailymenupicker.parser.menu.getMenuParser
import java.io.BufferedReader
import java.io.InputStreamReader
import java.net.HttpURLConnection
import java.net.URL
import java.io.StringReader
import javax.xml.parsers.DocumentBuilderFactory
import javax.xml.parsers.DocumentBuilder



/**
 * Created by mhajas on 3/18/18.
 */
fun main(args: Array<String>) {
    var config = Menu("ElementMenuParser", Day("DayNameDayParser", ""), "pre", Pair("",""))
    //var parser: ElementMenuParser = ElementMenuParser(config)
    //print(config)

    val url = "http://www.napurkynce.cz/denni-menu//"
    val obj = URL(url)

    val menuParser = getMenuParser(config) ?: throw UnknownMenuParser(config.toString())
    val dayParser = getDayParser(config.dayParser) ?: throw UnknownDayParser(config.dayParser.toString())

    val foods = dayParser.parse(menuParser.parse(Jsoup.connect(url).get()))

    println(foods.menuHeader)
    foods.menuItems.forEach { foodEntity: FoodEntity -> println(foodEntity.name) }

    //Jsoup.connect(url).get()

//    with(obj.openConnection() as HttpURLConnection) {
//        // optional default is GET
//        requestMethod = "GET"
//
//
//        println("\nSending 'GET' request to URL : $url")
//        println("Response Code : $responseCode")
//
//        BufferedReader(InputStreamReader(inputStream)).use {
//            val response = StringBuffer()
//
//            var inputLine = it.readLine()
//            while (inputLine != null) {
//                inputLine = it.readLine()
//                response.append(inputLine)
//            }
//
//            val db = DocumentBuilderFactory.newInstance().newDocumentBuilder()
//            var inputSource = InputSource()
//            inputSource.characterStream = StringReader(response.toString())
//
//            println(response.toString())
//
//            val doc = db.parse(inputSource)
//            val menuParser = getMenuParser(config) ?: throw UnknownMenuParser(config.toString())
//            val dayParser = getDayParser(config.dayParser) ?: throw UnknownDayParser(config.dayParser.toString())
//
//            val element = dayParser.parse(menuParser.parse(doc))
//            println(element)
//        }
//    }
}
//<html xmlns="http://www.w3.org/1999/xhtml"       xml:lang="cs"       xmlns:fb="http://www.facebook.com/2008/fbml"       xmlns:og="http://ogp.me/ns#"      lang="cs">  <head>    <meta http-equiv="content-type" content="text/html; charset=utf-8" /><script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,t,n){function r(n){if(!t[n]){var o=t[n]={exports:{}};e[n][0].call(o.exports,function(t){var o=e[n][1][t];return r(o||t)},o,o.exports)}return t[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,n){function r(){}function o(e,t,n){return function(){return i(e,[f.now()].concat(u(arguments)),t?null:this,n),t?void 0:this}}var i=e("handle"),a=e(2),u=e(3),c=e("ee").get("tracer"),f=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,t){s[t]=o(d+t,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),t.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,t){var n={},r=this,o="function"==typeof t;return i(l+"tracer",[f.now(),e,n],r),function(){if(c.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return t.apply(this,arguments)}catch(e){throw c.emit("fn-err",[arguments,this,e],n),e}finally{c.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,t){m[t]=o(l+t)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,f.now()])}},{}],2:[function(e,t,n){function r(e,t){var n=[],r="",i=0;for(r in e)o.call(e,r)&&(n[i]=t(r,e[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],3:[function(e,t,n){function r(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,o=n-t||0,i=Array(o<0?0:o);++r<o;)i[r]=e[t+r];return i}t.exports=r},{}],4:[function(e,t,n){t.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,t,n){function r(){}function o(e){function t(e){return e&&e instanceof r?e:e?c(e,u,i):i()}function n(n,r,o,i){if(!d.aborted||i){e&&e(n,r,o);for(var a=t(o),u=m(n),c=u.length,f=0;f<c;f++)u[f].apply(a,r);var p=s[y[n]];return p&&p.push([b,n,r,a]),a}}function l(e,t){v[e]=m(e).concat(t)}function m(e){return v[e]||[]}function w(e){return p[e]=p[e]||o(n)}function g(e,t){f(e,function(e,n){t=t||"feature",y[n]=t,t in s||(s[t]=[])})}var v={},y={},b={on:l,emit:n,get:w,listeners:m,context:t,buffer:g,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",c=e("gos"),f=e(2),s={},p={},d=t.exports=o();d.backlog=s},{}],gos:[function(e,t,n){function r(e,t,n){if(o.call(e,t))return e[t];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[t]=r,r}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],handle:[function(e,t,n){function r(e,t,n,r){o.buffer([e],r),o.emit(e,t,n)}var o=e("ee").get("handle");t.exports=r,r.ee=o},{}],id:[function(e,t,n){function r(e){var t=typeof e;return!e||"object"!==t&&"function"!==t?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");t.exports=r},{}],loader:[function(e,t,n){function r(){if(!x++){var e=h.info=NREUM.info,t=d.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&t))return s.abort();f(y,function(t,n){e[t]||(e[t]=n)}),c("mark",["onload",a()+h.offset],null,"api");var n=d.createElement("script");n.src="https://"+e.agent,t.parentNode.insertBefore(n,t)}}function o(){"complete"===d.readyState&&i()}function i(){c("mark",["domContent",a()+h.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-h.offset}var u=(new Date).getTime(),c=e("handle"),f=e(2),s=e("ee"),p=window,d=p.document,l="addEventListener",m="attachEvent",w=p.XMLHttpRequest,g=w&&w.prototype;NREUM.o={ST:setTimeout,SI:p.setImmediate,CT:clearTimeout,XHR:w,REQ:p.Request,EV:p.Event,PR:p.Promise,MO:p.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1071.min.js"},b=w&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),h=t.exports={offset:u,now:a,origin:v,features:{},xhrWrappable:b};e(1),d[l]?(d[l]("DOMContentLoaded",i,!1),p[l]("load",r,!1)):(d[m]("onreadystatechange",o),p[m]("onload",r)),c("mark",["firstbyte",u],null,"api");var x=0,E=e(4)},{}]},{},["loader"]);</script>    <script type="text/javascript" src="/ext_libs/jquery.js"></script>    <script type="text/javascript" src="/ext_libs/jquery.timers.js"></script>        <script type="text/javascript" src="/./compiled/fetchtemplate/tpl-files-include_gallery_body-c225c97b14741754e52a35daecd18cee.js"></script>    <link rel="stylesheet" type="text/css" href="/ext_libs/slimbox/css/slimbox2.css"/>    <script type="text/javascript" src="/ext_libs/slimbox/js/slimbox2.js"></script>    <script type="text/javascript" src="/./compiled/fetchtemplate/tpl-include_calendar_body-07e6da356e53ca3fc0402629563df597.js"></script>    <link href="/./compiled/css/css-_skins-purkynka-25a22af33b5dffe87ea5a5622f014006.css" rel="StyleSheet" type="text/css" />    <link rel="shortcut icon" href="/purkynka/_skins/purkynka/favico/_showFile.php" />		<link href='http://fonts.googleapis.com/css?family=Courgette&subset=latin-ext' rel='stylesheet' type='text/css' />    <meta name="Description" content="Denní menu | Nabízíme vám českou kuchyni, speciality k pivu a vínu. Čepujeme tradičně vyráběná piva z malých a středních pivovarů." />    <meta name="Keywords" content="na purkynce" />    <meta name="Author" content="GrowJOB institute" />    <meta name="Email" content="info@napurkynce.cz" />    <meta name="Language" content="cs" />    <meta http-equiv="content-language" content="cs" />    <meta name="Robots" content="index, follow" />    <title>      Denní menu | Na Purkyňce    </title>          <!-- HEADER TAGS -->      <link rel="canonical" href="http://www.napurkynce.cz/purkynka/denni-menu/" /><!-- link-canonical-noparams -->      <link rel="alternate" hreflang="en" lang="en" title="English" href="http://www.napurkynce.cz/purkynka/daily-menu/" /><!-- languageVariants-en -->      <meta property="og:url" content="http://www.napurkynce.cz/purkynka/denni-menu/" /><!-- og:url-noparams -->    <script type="text/javascript">    /* <![CDATA[ */  var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-5327682-23']);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);  })(); /* ]]> */    </script>  </head>  <body>    <div style="display: none;">    <!-- phpmyvisites -->    <script type="text/javascript">        /* <![CDATA[ */        var a_vars = Array();        var pagename = '/purkynka/mainmenu/daily-menu'        var phpmyvisitesSite = 103;        var phpmyvisitesURL = '/phpmv2/phpmyvisites.php';        /* ]]> */    </script>    <script src="/phpmv2/phpmyvisites.js" type="text/javascript"></script>    <!-- /phpmyvisites --></div>    <div class="pgcenter" id="page"><div class="pgcontent" id="header">  <div class="bg-center-top hidden"></div>   <div class="hidden"><span class="no-show">    Navigace:      |      <a href="#mainmenu" title="Hlavní menu">Hlavní menu</a>      |      <a accesskey="0" href="#content" title="Obsah stránek">Obsah stránek</a>      |    </span><hr class="no-show"/></div>   <h1><a accesskey="2" href="http://www.napurkynce.cz/purkynka/" title="Na Purkyňce"><img src="/ariadne/file_generators/dbfile.php?_fileId=564&amp;_fileName=logo.png&amp;_site=drevenaruze_purkynka" alt="Denní menu - Na Purkyňce<span></span>" /></a></h1>   <hr class="no-show" />       <div class="lang">                            <a href="/purkynka/denni-menu/" class="lang-active" title="Česky">Česky</a>              /        <a href="/purkynka/daily-menu/"  title="English">English</a>          </div>        <hr class="no-show" />       <script type="text/javascript">    /* <![CDATA[ */      searchFocus = function(elm) {        if (elm.value == "Hledaný text ...")          elm.value = "";          $(elm).addClass("searchfocus");        }      searchLostFocus = function(elm) {        if (elm.value == "")          elm.value = "Hledaný text ...";        if (elm.value == "Hledaný text ...")          $(elm).removeClass("searchfocus");        }    /* ]]> */    </script>    <form method="get" action="/purkynka/denni-menu/" class="search" id="layoutSearch" >      <fieldset>        <label for="searchedText" class="hidden">Fulltextové vyhledávání:</label>        <input type="hidden" name="_site" value="drevenaruze_purkynka" />        <input type="hidden" name="_op" value="fulltext" />        <input accesskey="4" type="text"               value="Hledaný text ..."               id="searchedText" name="searchedText" class="i-text"               onfocus="searchFocus(this);" onblur="searchLostFocus(this);" />        <input type="submit"               name="search" value="" class="i-button" />        <input type="text" style="position: absolute; top: auto; left: -10000px;" readonly="readonly" />      </fieldset>    </form>    <hr class="no-show" />      <a class="virtual-tour" target="_blank" href="https://www.google.cz/maps/@49.222739,16.584643,3a,75y,150.19h,89.82t/data=!3m8!1e1!3m6!1s9hDBn888C88AAAQYn8xQLA!2e0!3e2!6s%2F%2Fgeo2.ggpht.com%2Fcbk%3Fpanoid%3D9hDBn888C88AAAQYn8xQLA%26output%3Dthumbnail%26cb_client%3Dsearch.TACTILE.gps%26thumb%3D2%26w%3D203%26h%3D100%26yaw%3D148.41037%26pitch%3D0!7i13312!8i6656!6m1!1e1?hl=cs"><img src="/ariadne/file_generators/dbfile.php?_fileId=737&amp;_fileName=virtual-icon.png&amp;_site=drevenaruze_purkynka" /><div>Virtuální<br />prohlídka</div></a>   <div class="no-show">         Horní menu:            <hr class="no-show" />   </div>      <div class="motto">  	Ze všech lásek nejupřímnější je láska k jídlu.<br /> -- G. B. Shaw    <hr />  </div>      <div id="sideCol" class="menu">      <span id="mainmenu" class="no-show">Hlavní menu:</span>            <ul id="menu">                      <li>        <a href="/purkynka/uvod/" title="Úvod">Úvod</a>                    </li>                        <li>        <a class="active" href="/purkynka/denni-menu/" title="Denní menu">Denní menu</a>                    </li>                        <li>        <a href="/purkynka/jidelni-listek/" title="Jídelní lístek">Jídelní lístek</a>                    </li>                        <li>        <a href="/purkynka/napojovy-listek/" title="Nápojový lístek">Nápojový lístek</a>                    </li>                </ul>    		<a href="http://www.facebook.com/NaPurkynce" class="facebook">Navštivte nás</a>    <hr class="no-show" />  </div>      <div class="nav" id="currentPage">      <span class="nav-title">Právě si prohlížíte:</span>                            <a href="/purkynka/denni-menu/" title=" Denní menu" class="nav-active">Denní menu</a>                  <span class="openning"><strong>Otevřeno denně: 11:00 - 0:00</strong></span>    </div>    <hr class="no-show" />           <div class="content" id="content"><!--<h2>Denní menu</h2>--><p><a href="http://www.liquidbread.cz/liquidbread/liquidbread/mainmenu/daily-menu/">Nevybrali jste si? Zkuste naši nově otevřenou restauraci Liquid Bread</a></p><p><a href="https://www.google.cz/maps/place/Purky%C5%88ova+3049%2F35g,+612+00+Brno-Kr%C3%A1lovo+Pole/@49.2216704,16.5840171,17.5z/data=!4m5!3m4!1s0x471294052f2553dd:0x967c1ff521022a0b!8m2!3d49.2210433!4d16.5844598?hl=cs">Mapa zde</a></p><p></p><pre>Menu 19.-23.3.2018<br /><br />PONDĚLÍ: Polévka: Bramborovo–pórkový krém<br />a) Kuřecí řízek Ondráš (kuřecí prsíčko v bramborákovém těstě), červené zelí s křenem 99,-<br />b) Vídeňský guláš s cibulkou, domácí špekový knedlík 107,-<br />c) Smažené tvarůžky s poličanem, vařené brambory, tatarská omáčka 97,-<br />d) Pečené kachní stehýnko, červené zelí, bramborový knedlík, vídeňská cibulka 159,-<br /><br />ÚTERÝ: Polévka: Rajská s rýží (těstovinami)<br />a) Špikovaná vepřová kotleta, masová omáčka se zázvorem, gratinované brambory 105,-<br />b) Domácí sekaná s bramborovou kaší, okurek 99,-<br />c) Špagety aglio olio e peperoncino 95,-<br />d) Pečené kachní stehýnko, červené zelí, bramborový knedlík, vídeňská cibulka 159,-<br /><br />STŘEDA: Polévka: Cibulový krém se (sýrovými) krutony<br />a) Krůtí steak na grilu, tagliatelle se smetano-špenátovou omáčkou 99,-<br />b) Hovězí Stroganov, hranolky 105,-<br />c) Smažená mořská štika s bramborovou kaší, okurkový salát 105,-<br />d) Pečené kachní stehýnko, červené zelí, bramborový knedlík, vídeňská cibulka 159,-<br /><br />ČTVRTEK: Polévka: Frankfurtská<br />a) Vepřová panenka (filovaná) plněná kuřecí fáší, šťouchané brambory 105,-<br />b) Moravský talíř - vepřový výpeček, uzené maso, opečená klobása na červeném zelí s variací knedlíků 99,-<br />c) Salát z čerstvé zeleniny s balkánským sýrem, vejce, olivy, opečený toast 99,-<br />d) Pečené kachní stehýnko, červené zelí, bramborový knedlík, vídeňská cibulka 159,-<br /><br />PÁTEK: Polévka: Slepičí vývar s masem, zeleninou a kapáním<br />a) Hovězí hamburger "Classic" (hovězí mleté maso, zelenina, majonéza, kečup, křupavá slanina), hranolky 107,-<br />b) Trhané kuře na paprice s těstovinou 97,-<br />c) Francouzské brambory, okurek 92,-<br />d) Pečené kachní stehýnko, červené zelí, bramborový knedlík, vídeňská cibulka 159,-</pre><hr class="no-show" /><p style="width: 100%; text-align: right; padding-bottom: 0px;">  <span class="no-show">Akce:</span>  <a rel="nofollow" class="printLink" href="/purkynka/denni-menu/_changeskin.php?skin=/_skins/print-purkynka" title="Otevřít verzi pro tisk">      [ Tisk ]    </a></p><hr class="no-show"/><div class="no-show">    Soubory:</div> </div><hr />    <div class="aftercontent">    <div class="karty">      <span>Přijímáme tyto<br />platební karty</span><br class="hidden" />            <img src="/ariadne/file_generators/dbfile.php?_fileId=560&amp;_fileName=k-visa.png&amp;_site=drevenaruze_purkynka" alt="Visa" />      <img src="/ariadne/file_generators/dbfile.php?_fileId=556&amp;_fileName=k-visa-e.png&amp;_site=drevenaruze_purkynka" alt="Visa Electron" />            <img src="/ariadne/file_generators/dbfile.php?_fileId=552&amp;_fileName=k-mastercard.png&amp;_site=drevenaruze_purkynka" alt="MasterCard" />      <img src="/ariadne/file_generators/dbfile.php?_fileId=548&amp;_fileName=k-maestro.png&amp;_site=drevenaruze_purkynka" alt="Maestro" />                  </div>    <div class="stravenky">      <span>Možnost<br />platit s</span><br class="hidden" />            <img src="/ariadne/file_generators/dbfile.php?_fileId=612&amp;_fileName=s-gastropass.png&amp;_site=drevenaruze_purkynka" alt="Gastro Pass" />      <img src="/ariadne/file_generators/dbfile.php?_fileId=616&amp;_fileName=s-ticket.png&amp;_site=drevenaruze_purkynka" alt="Ticket Restaurant" />            <img src="/ariadne/file_generators/dbfile.php?_fileId=608&amp;_fileName=s-cheque.png&amp;_site=drevenaruze_purkynka" alt=" Le Cheque Déjeuner" />              </div>      </div><hr />  <div class="footer" id="footer">    <div class="bottom-menu">      <strong>Menu:</strong>            <ul>          <li><a href="/purkynka/rezervace/" title="Rezervace">Rezervace</a></li>          <li><a href="/purkynka/kontakt/" title="Kontakt">Kontakt</a></li>          <li><a href="/purkynka/mapa-stranek/" title="Mapa stránek">Mapa stránek</a></li>          <li><a href="/purkynka/purkynka/bottommenu/login/" title="Administrace">Administrace</a></li>        </ul>            </div>    <div class="second-pub">      <a href="http://www.drevenaruze.cz">      <img src="/ariadne/file_generators/dbfile.php?_fileId=869&amp;_fileName=drevena-ico.png&amp;_site=drevenaruze_purkynka" />      <div>Navštivte i naši druhou restauraci<br />Dřevěná růže.</div>      </a>    </div><hr />        <div class="contact">      <strong>Adresa:</strong><br />       <span class="a-name">Na Purkyňce</span><br />      Purkyňova 80<br />      612 00 Brno - Královo Pole<br /><br />            <span class="a-tel">T:</span> +420 530 340 995 | +420 731 490 387 <br />      <span class="a-tel">E:</span> <a href="info@napurkynce.cz">info@napurkynce.cz</a>    </div>        <a href="http://goo.gl/maps/bVh89" class="map">Zobrazit na mapě</span></a>    <a href="http://www.facebook.com/NaPurkynce" class="fb-like hidden"><span class="hidden"><br />Facebook</span></a>           </div><hr />  <div class="copyright">    &copy;&nbsp;2013&nbsp;-&nbsp;2018,  Created by	<a href="http://www.growjob.com" title="Růst bez náhody | konzultace a realizace">GrowJOB institute</a>  </div>      <hr class="no-show" />        <span class="no-show">  Navigace:      |      <a href="#mainmenu" title="Hlavní menu">Hlavní menu</a>      |      <a href="#content" title="Obsah stránek">Obsah stránek</a>      |    </span><hr />  <div class="bg-center-bottom hidden"></div></div></div><div class="bottom-bg"></div> <!-- end #page --><script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","licenseKey":"6b4c9be34f","applicationID":"54336675","transactionName":"bgBXZUZYW0tVAUELWFdKdkRHTVpVGxVQAEdYAlALDkpdV0M9QgdVSgxBVGtcTV1XF0EH","queueTime":0,"applicationTime":198,"ttGuid":"","agentToken":"","userAttributes":"","errorBeacon":"bam.nr-data.net","agent":""}</script></body></html>null

